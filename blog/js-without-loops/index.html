<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>无循环 JavaScript | 笑笑前端圈</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="JavaScript" />
    
    <meta name="description" content="之前有讨论过，缩进导致了代码复杂性的增加（以粗鲁的方式）。我们的目标是写出复杂度低的 JavaScript 代码。通过选择一种合适的抽象来解决这个问题，可是你怎么能知道选择哪一种抽象呢？很遗憾的是到目前为止，没有找到一个具体的例子能解释这一问题。这篇文章中我们讨论不用任何循环如何处理 JavaScript 数组，最终得出的效果是得到低复杂度的代码。

循环是一种很重要的控制结构，它很难被重用，也很">
<meta property="og:type" content="article">
<meta property="og:title" content="无循环 JavaScript">
<meta property="og:url" content="http://xiaoxiaoqdq.com/blog/js-without-loops/index.html">
<meta property="og:site_name" content="笑笑前端圈">
<meta property="og:description" content="之前有讨论过，缩进导致了代码复杂性的增加（以粗鲁的方式）。我们的目标是写出复杂度低的 JavaScript 代码。通过选择一种合适的抽象来解决这个问题，可是你怎么能知道选择哪一种抽象呢？很遗憾的是到目前为止，没有找到一个具体的例子能解释这一问题。这篇文章中我们讨论不用任何循环如何处理 JavaScript 数组，最终得出的效果是得到低复杂度的代码。

循环是一种很重要的控制结构，它很难被重用，也很">
<meta property="og:image" content="https://huzidaha.github.io/images-store/201702/6-1javascript-without-loops.png">
<meta property="og:updated_time" content="2017-03-12T05:50:36.391Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="无循环 JavaScript">
<meta name="twitter:description" content="之前有讨论过，缩进导致了代码复杂性的增加（以粗鲁的方式）。我们的目标是写出复杂度低的 JavaScript 代码。通过选择一种合适的抽象来解决这个问题，可是你怎么能知道选择哪一种抽象呢？很遗憾的是到目前为止，没有找到一个具体的例子能解释这一问题。这篇文章中我们讨论不用任何循环如何处理 JavaScript 数组，最终得出的效果是得到低复杂度的代码。

循环是一种很重要的控制结构，它很难被重用，也很">
<meta name="twitter:image" content="https://huzidaha.github.io/images-store/201702/6-1javascript-without-loops.png">
    

    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.0.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
    

</head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">主页</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/前端笔记/">前端笔记</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/前端笔记/CSS/">CSS</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/前端笔记/JavaScript/">JavaScript</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/前端笔记/Service/">Service</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/面试宝典/">面试宝典</a></li></ul>
                                    
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/about/index.html">关于</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/前端笔记/">前端笔记</a><i class="icon fa fa-angle-right"></i><a class="page-title-link" href="/categories/前端笔记/JavaScript/">JavaScript</a>
    </h1>
</div>
                        <div class="main-body-content">
                            <article id="post-js-without-loops" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        无循环 JavaScript
        </h1>
    

            </header>
        
        
            <div class="article-subtitle">
                
	<i class="icon fa fa-user"></i>
    <span class="article-author">James Sinclair</span>

                <i class="icon fa fa-clock-o"></i>
<a href="/blog/js-without-loops/" class="article-date">
    <time datetime="2017-03-11T14:52:00.000Z" itemprop="datePublished">2017-03-11</time>
</a>
                <i class="icon fa fa-eye"></i>
<span id="/blog/js-without-loops/" class="leancloud-views_num" data-flag-title="无循环 JavaScript"></span>

                
    <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <p>之前有讨论过，<a href="http://jrsinclair.com/articles/2017/indentation-is-the-enemy-less-complex-javascript/" target="_blank" rel="external">缩进导致了代码复杂性的增加（以粗鲁的方式）</a>。我们的目标是写出复杂度低的 JavaScript 代码。通过选择一种合适的抽象来解决这个问题，可是你怎么能知道选择哪一种抽象呢？很遗憾的是到目前为止，没有找到一个具体的例子能解释这一问题。这篇文章中我们讨论不用任何循环如何处理 JavaScript 数组，最终得出的效果是得到低复杂度的代码。</p>
<p><img src="https://huzidaha.github.io/images-store/201702/6-1javascript-without-loops.png" alt=""></p>
<p><em>循环是一种很重要的控制结构，它很难被重用，也很难插入到其他操作之中。另外，它意味着随着每次迭代，代码也在不断的变化之中。——Luis Atencio</em></p>
<h2 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h2><p>我们先前说过，像循环这样的控制结构引入了复杂性。但是至今也没能很好的解释这是如何发生的。那么我们首先来看一下在 JavaScript 中循环是如何起作用的。</p>
<p>在 JavaScript 中，至少有四、五种实现循环的方法。最基础的是 <code>while</code> 循环。首先，先创建一个示例函数和数组。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// oodlify :: String -&gt; String</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">oodlify</span>(<span class="params">s</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> s.replace(<span class="regexp">/[aeiou]/g</span>, <span class="string">'oodle'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> input = [</div><div class="line">    <span class="string">'John'</span>,</div><div class="line">    <span class="string">'Paul'</span>,</div><div class="line">    <span class="string">'George'</span>,</div><div class="line">    <span class="string">'Ringo'</span>,</div><div class="line">];</div></pre></td></tr></table></figure></p>
<p>现在有了一个数组，我们想要用 <em>oodlify</em> 函数处理每一个元素。如果用 <code>while</code> 循环，就类似于这样：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> i = <span class="number">0</span>;</div><div class="line"><span class="keyword">const</span> len = input.length;</div><div class="line"><span class="keyword">let</span> output = [];</div><div class="line"><span class="keyword">while</span> (i &lt; len) &#123;</div><div class="line">    <span class="keyword">let</span> item = input[i];</div><div class="line">    <span class="keyword">let</span> newItem = oodlify(item);</div><div class="line">    output.push(newItem);</div><div class="line">    i = i + <span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注意看好每一步，首先用了一个计数器 i，把这个计数器初始化为 0，然后在每次循环中将其自增。每次必须要和 <em>len</em> 进行比较以保证它在那里停下来。这种方式太有共性了，所以 JavaScript 提供了一个更简单的实现方式： <code>for</code> 循环，写起来如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> len = input.length;</div><div class="line"><span class="keyword">let</span> output = [];</div><div class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; i = i + <span class="number">1</span>) &#123;</div><div class="line">    <span class="keyword">let</span> item = input[i];</div><div class="line">    <span class="keyword">let</span> newItem = oodlify(item);</div><div class="line">    output.push(newItem);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这一结构非常有用，它把所有的计数器引用都放到了最上面，而 <code>while</code> 循环非常容易把自增的 i 给忘掉，进而引起无限循环。这确实是一个改进，但是重新思考一下这个问题。我们想要达到的目标是在数组的每个元素上运行 <em>oodlify()</em> 函数，并且将结果放到一个新的数组中，我们并不关心计数器的问题。</p>
<p>对一个数组中每个元素都进行操作的这种模式也是非常普遍的。因此，在 ES2015 中，有了一种新的循环结构，这种循环结构可以丢弃掉计数器： <code>for...of</code> 循环。每一次返回数组的下一个元素给你，代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> output = [];</div><div class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> input) &#123;</div><div class="line">    <span class="keyword">let</span> newItem = oodlify(item);</div><div class="line">    output.push(newItem);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这样就清晰很多，注意这里计数器和比较都不用了，甚至都不用将数组里的元素做一步额外的取出操作。<code>for...of</code> 帮我们做了里面的脏活累活。到此为止，我们用 <code>for...of</code> 来代替 <code>for</code> 循环，可以很大程度上降低复杂性。但是，我们还可以进一步优化它。</p>
<h2 id="mapping"><a href="#mapping" class="headerlink" title="mapping"></a>mapping</h2><p><code>for...of</code> 循环比 <code>for</code> 循环更清晰，但是依然需要一些设定性的代码。如不得不初始化一个 <em>output</em> 数组并且每次循环都要调用 <em>push()</em> 函数。但是如何解决这个问题，我们不妨先来扩展一下问题。</p>
<p>如果有两个数组需要调用 <em>oodlify</em> 函数会怎么样？<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> fellowship = [</div><div class="line">    <span class="string">'frodo'</span>,</div><div class="line">    <span class="string">'sam'</span>,</div><div class="line">    <span class="string">'gandalf'</span>,</div><div class="line">    <span class="string">'aragorn'</span>,</div><div class="line">    <span class="string">'boromir'</span>,</div><div class="line">    <span class="string">'legolas'</span>,</div><div class="line">    <span class="string">'gimli'</span>,</div><div class="line">];</div><div class="line"></div><div class="line"><span class="keyword">const</span> band = [</div><div class="line">    <span class="string">'John'</span>,</div><div class="line">    <span class="string">'Paul'</span>,</div><div class="line">    <span class="string">'George'</span>,</div><div class="line">    <span class="string">'Ringo'</span>,</div><div class="line">];</div></pre></td></tr></table></figure></p>
<p>很直观的想法是为每个数组做循环：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> bandoodle = [];</div><div class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> band) &#123;</div><div class="line">    <span class="keyword">let</span> newItem = oodlify(item);</div><div class="line">    bandoodle.push(newItem);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> floodleship = [];</div><div class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> fellowship) &#123;</div><div class="line">    <span class="keyword">let</span> newItem = oodlify(item);</div><div class="line">    floodleship.push(newItem);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这确实ok。有能正确执行的代码，就比没有好。但是，这是重复性的工作——不够“<a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" target="_blank" rel="external">DRY</a>”。我们来重构它以降低它的重复性，创建一个函数：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">oodlifyArray</span>(<span class="params">input</span>) </span>&#123;</div><div class="line">    <span class="keyword">let</span> output = [];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> input) &#123;</div><div class="line">        <span class="keyword">let</span> newItem = oodlify(item);</div><div class="line">        output.push(newItem);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> output;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> bandoodle = oodlifyArray(band);</div><div class="line"><span class="keyword">let</span> floodleship = oodlifyArray(fellowship);</div></pre></td></tr></table></figure></p>
<p>这看起来好多了，可是如果我们想使用另外一个函数该怎么办？<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">izzlify</span>(<span class="params">s</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> s.replace(<span class="regexp">/[aeiou]+/g</span>, <span class="string">'izzle'</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>上面的 <em>oodlifyArray()</em> 将不起作用了。可是如果再创建一个 <em>izzlifyArray()</em> 函数的话，那就又变成重复的问题了。先不管那么多，我们先将他们并排写出来：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">oodlifyArray</span>(<span class="params">input</span>) </span>&#123;</div><div class="line">    <span class="keyword">let</span> output = [];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> input) &#123;</div><div class="line">        <span class="keyword">let</span> newItem = oodlify(item);</div><div class="line">        output.push(newItem);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> output;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">izzlifyArray</span>(<span class="params">input</span>) </span>&#123;</div><div class="line">    <span class="keyword">let</span> output = [];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> input) &#123;</div><div class="line">        <span class="keyword">let</span> newItem = izzlify(item);</div><div class="line">        output.push(newItem);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> output;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这两个函数惊人的相似。那么我们是不是可以把他们抽象成一个通用的模式呢？我们想要的是：<em>给定一个函数和一个数组，通过这个函数，把数组中的每一个元素做操作后放到新的数组中。</em>我们把这个模式叫做 <em>map</em> 。一个数组的 map 函数如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">map</span>(<span class="params">f, a</span>) </span>&#123;</div><div class="line">    <span class="keyword">let</span> output = [];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> a) &#123;</div><div class="line">        output.push(f(item));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> output;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当然，这里并没有完全脱离循环。如果想要脱离循环的话，可以做一个递归的版本出来：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">map</span>(<span class="params">f, a</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (a.length === <span class="number">0</span>) &#123; <span class="keyword">return</span> []; &#125;</div><div class="line">    <span class="keyword">return</span> [f(a[<span class="number">0</span>])].concat(map(f, a.slice(<span class="number">1</span>)));</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>递归解决方法非常优雅，仅仅用了两行代码，并且只有很少的缩进。但是通常我们并不倾向于使用递归，因为它在较老的浏览器中的性能非常差。实际上，我们并不是非得自己写 <em>map</em>（除非我们自己想写）。<em>map</em> 模式非常有共性，因此 JavaScript 提供了一个内置 <em>map</em> 方法。使用这个 <em>map</em> 方法，上面的代码变成了这样：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> bandoodle     = band.map(oodlify);</div><div class="line"><span class="keyword">let</span> floodleship   = fellowship.map(oodlify);</div><div class="line"><span class="keyword">let</span> bandizzle     = band.map(izzlify);</div><div class="line"><span class="keyword">let</span> fellowshizzle = fellowship.map(izzlify);</div></pre></td></tr></table></figure></p>
<p>可以注意到，缩进消失，循环消失。诚然，循环可能转移到了其他地方，可是这并不是我们所关心的。我们的代码现在变得简洁而富有表达张力。</p>
<p>为什么这个代码这么简单呢？这可能是个很傻的问题，不过也请思考一下。是因为短吗？不是，短并不代表不复杂。它很简单，是因为我们把问题分离了。有两个处理字符串的函数： <em>oodlify</em> 和 <em>izzlify</em>，这些函数并不需要知道关于数组或者循环的任何事情。同时，有另外一个函数： <em>map</em> ，它来处理数组，它不需要知道数组中元素是什么类型的，甚至你想对数组做什么也不用关心。它只需要执行我们所传递的函数就可以了。我们从对数组的处理中，把对字符串的处理分离出来，而不是把它们都混在一起。这就是为什么我们说上面的代码很简单。</p>
<h2 id="reducing"><a href="#reducing" class="headerlink" title="reducing"></a>reducing</h2><p>现在，<em>map</em> 已经得心应手了，但是这并没有覆盖到可能需要的每一种循环。只有当你想创建一个和输入数组同样长度的数组时才有用。但是如果你想要向数组中增加几个元素呢？或者想找一个列表中的最短字符串是哪个？其实有时我们对数组进行处理，最终只想得到一个值而已。</p>
<p>来看一个例子，现在有一个关于英雄的数组：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> heroes = [</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Hulk'</span>, <span class="attr">strength</span>: <span class="number">90000</span>&#125;,</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Spider-Man'</span>, <span class="attr">strength</span>: <span class="number">25000</span>&#125;,</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Hawk Eye'</span>, <span class="attr">strength</span>: <span class="number">136</span>&#125;,</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Thor'</span>, <span class="attr">strength</span>: <span class="number">100000</span>&#125;,</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Black Widow'</span>, <span class="attr">strength</span>: <span class="number">136</span>&#125;,</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Vision'</span>, <span class="attr">strength</span>: <span class="number">5000</span>&#125;,</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Scarlet Witch'</span>, <span class="attr">strength</span>: <span class="number">60</span>&#125;,</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Mystique'</span>, <span class="attr">strength</span>: <span class="number">120</span>&#125;,</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Namora'</span>, <span class="attr">strength</span>: <span class="number">75000</span>&#125;,</div><div class="line">];</div></pre></td></tr></table></figure></p>
<p>我们想找最强壮的英雄。使用 <code>for...of</code> 循环，像这样：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> strongest = &#123;<span class="attr">strength</span>: <span class="number">0</span>&#125;;</div><div class="line"><span class="keyword">for</span> (hero <span class="keyword">of</span> heroes) &#123;</div><div class="line">    <span class="keyword">if</span> (hero.strength &gt; strongest.strength) &#123;</div><div class="line">        strongest = hero;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>虽然这个代码可以正确运行，可是实在太烂了。看这个循环，每次都保存到目前为止最强的英雄。继续提需求，接下来我们想要所有英雄的组合强度值：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> combinedStrength = <span class="number">0</span>;</div><div class="line"><span class="keyword">for</span> (hero <span class="keyword">of</span> heroes) &#123;</div><div class="line">    combinedStrength += hero.strength;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在这两个例子中，都在循环开始之前初始化了一个变量。然后在每一次的循环中，处理一个数组元素，并且更新这个变量。为了使循环变得清晰，现在把数组中间的部分进行重构，重构到函数中。我们要重命名这些变量，以进一步突出相似性。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">greaterStrength</span>(<span class="params">champion, contender</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> (contender.strength &gt; champion.strength) ? contender : champion;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">addStrength</span>(<span class="params">tally, hero</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> tally + hero.strength;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> initialStrongest = &#123;<span class="attr">strength</span>: <span class="number">0</span>&#125;;</div><div class="line"><span class="keyword">let</span> working = initialStrongest;</div><div class="line"><span class="keyword">for</span> (hero <span class="keyword">of</span> heroes) &#123;</div><div class="line">    working = greaterStrength(working, hero);</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> strongest = working;</div><div class="line"></div><div class="line"><span class="keyword">const</span> initialCombinedStrength = <span class="number">0</span>;</div><div class="line">working = initialCombinedStrength;</div><div class="line"><span class="keyword">for</span> (hero <span class="keyword">of</span> heroes) &#123;</div><div class="line">    working = addStrength(working, hero);</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> combinedStrength = working;</div></pre></td></tr></table></figure></p>
<p>写到这，两个循环变得非常相似了。它们两个之间唯一的区别是调用的函数和初始值不同。两个的功能都是对数组进行处理，最终得到一个值。所以，我们创建一个 <em>reduce</em> 函数来封装这个模式。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">reduce</span>(<span class="params">f, initialVal, a</span>) </span>&#123;</div><div class="line">    <span class="keyword">let</span> working = initialVal;</div><div class="line">    <span class="keyword">for</span> (item <span class="keyword">of</span> a) &#123;</div><div class="line">        working = f(working, item);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> working;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><em>reduce</em> 模式在 JavaScript 中也是非常通用，因此 JavaScript 为数组提供了内置的方法，不需要自己来写。通过内置方法，代码就变成了：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> strongestHero = heroes.reduce(greaterStrength, &#123;<span class="attr">strength</span>: <span class="number">0</span>&#125;);</div><div class="line"><span class="keyword">const</span> combinedStrength = heroes.reduce(addStrength, <span class="number">0</span>);</div></pre></td></tr></table></figure></p>
<p>ok，如果你认真思考，你会注意到上面的代码其实并没有短很多。不过也确实比自己手写的 <em>reduce</em> 代码少写了几行。但是我们的目标并不是使代码变短或者少写，而是降低复杂度。那么，我们降低了复杂度了吗？我会说是的。我们把处理个体的循环代码给分离了出去，现在的代码具有很少的耦合性，即很少的互相调用，复杂度得以下降。</p>
<p><em>reduce</em> 方法乍一看可能觉得非常基础。关于 <em>reduce</em> 的例子大部分也都很简单，比如做加法。但是没有人说 <em>reduce</em> 方法只能返回基本类型，它可以是一个 object 类型，甚至可以是另一个数组。当我首次意识到这个问题的时候，自己也是豁然开朗。所以我们其实可以用 <em>reduce</em> 方法来写 <em>map</em> 或者 <em>filter</em>，这里我把这个任务留给你们自己来尝试。</p>
<h2 id="filtering"><a href="#filtering" class="headerlink" title="filtering"></a>filtering</h2><p>现在我们有了 <em>map</em> 处理数组中的每个元素，有了 <em>reduce</em> 处理数组维度，经过计算降到只得到一个值。但是如果想获取数组中的某些元素该怎么办？我们来进一步探索，现在增加一些属性到上面的英雄数组中：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> heroes = [</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Hulk'</span>, <span class="attr">strength</span>: <span class="number">90000</span>, <span class="attr">sex</span>: <span class="string">'m'</span>&#125;,</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Spider-Man'</span>, <span class="attr">strength</span>: <span class="number">25000</span>, <span class="attr">sex</span>: <span class="string">'m'</span>&#125;,</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Hawk Eye'</span>, <span class="attr">strength</span>: <span class="number">136</span>, <span class="attr">sex</span>: <span class="string">'m'</span>&#125;,</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Thor'</span>, <span class="attr">strength</span>: <span class="number">100000</span>, <span class="attr">sex</span>: <span class="string">'m'</span>&#125;,</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Black Widow'</span>, <span class="attr">strength</span>: <span class="number">136</span>, <span class="attr">sex</span>: <span class="string">'f'</span>&#125;,</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Vision'</span>, <span class="attr">strength</span>: <span class="number">5000</span>, <span class="attr">sex</span>: <span class="string">'m'</span>&#125;,</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Scarlet Witch'</span>, <span class="attr">strength</span>: <span class="number">60</span>, <span class="attr">sex</span>: <span class="string">'f'</span>&#125;,</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Mystique'</span>, <span class="attr">strength</span>: <span class="number">120</span>, <span class="attr">sex</span>: <span class="string">'f'</span>&#125;,</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Namora'</span>, <span class="attr">strength</span>: <span class="number">75000</span>, <span class="attr">sex</span>: <span class="string">'f'</span>&#125;,</div><div class="line">];</div></pre></td></tr></table></figure></p>
<p>ok，现在有两个问题，我们想要：</p>
<ol>
<li>找到所有的女性英雄；</li>
<li>找到所有能量值大于500的英雄。</li>
</ol>
<p>使用普通的 <code>for...of</code> 循环，会得到如下代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> femaleHeroes = [];</div><div class="line"><span class="keyword">for</span> (<span class="keyword">let</span> hero <span class="keyword">of</span> heroes) &#123;</div><div class="line">    <span class="keyword">if</span> (hero.sex === <span class="string">'f'</span>) &#123;</div><div class="line">        femaleHeroes.push(hero);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> superhumans = [];</div><div class="line"><span class="keyword">for</span> (<span class="keyword">let</span> hero <span class="keyword">of</span> heroes) &#123;</div><div class="line">    <span class="keyword">if</span> (hero.strength &gt;= <span class="number">500</span>) &#123;</div><div class="line">        superhumans.push(hero);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>上面代码运行起来没有问题，是不是看起来还不错？但是里面又出现了重复的情况。实际上，区别在于 <code>if</code> 的判断语句，那么能不能把 <code>if</code> 语句重构到一个函数中呢？<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isFemaleHero</span>(<span class="params">hero</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> (hero.sex === <span class="string">'f'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isSuperhuman</span>(<span class="params">hero</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> (hero.strength &gt;= <span class="number">500</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> femaleHeroes = [];</div><div class="line"><span class="keyword">for</span> (<span class="keyword">let</span> hero <span class="keyword">of</span> heroes) &#123;</div><div class="line">    <span class="keyword">if</span> (isFemaleHero(hero)) &#123;</div><div class="line">        femaleHeroes.push(hero);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> superhumans = [];</div><div class="line"><span class="keyword">for</span> (<span class="keyword">let</span> hero <span class="keyword">of</span> heroes) &#123;</div><div class="line">    <span class="keyword">if</span> (isSuperhuman(hero)) &#123;</div><div class="line">        superhumans.push(hero);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这种只返回 <code>true</code> 或者 <code>false</code> 的函数，我们一般把它称作 <em>谓词</em>。这里用了谓词来判断是否保存当前的英雄元素项。</p>
<p>上面代码的写法会看起来比较长。但是这样的重构很好地避免了之前的代码重复问题。可以进一步地抽象到一个函数中。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">predicate, arr</span>) </span>&#123;</div><div class="line">    <span class="keyword">let</span> working = [];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> arr) &#123;</div><div class="line">        <span class="keyword">if</span> (predicate(item)) &#123;</div><div class="line">            working = working.concat(item);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> femaleHeroes = filter(isFemaleHero, heroes);</div><div class="line"><span class="keyword">const</span> superhumans  = filter(isSuperhuman, heroes);</div></pre></td></tr></table></figure></p>
<p>同 <em>map</em> 和 <em>reduce</em> 一样，JavaScript 提供了一个内置数组方法，没必要自己来实现（除非你自己想写）。用内置数组方法，上面的代码就变成了：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> femaleHeroes = heroes.filter(isFemaleHero);</div><div class="line"><span class="keyword">const</span> superhumans  = heroes.filter(isSuperhuman);</div></pre></td></tr></table></figure></p>
<p>为什么这段代码比 <code>for...of</code> 循环好呢？回想一下整个过程，我们要解决一个“找到满足某一条件的所有英雄”。使用 <em>filter</em> 使得问题变得简单化了。我们需要做的就是通过写一个简单函数来告诉 <em>filter</em> 哪一个数组元素要保留。不需要考虑数组是什么样的，以及繁琐的中间变量。取而代之的是一个简单的谓词函数，仅此而已。</p>
<p>与其他的迭代器相比，使用 <em>filter</em> 是一个出小力办大事的过程。我们不需要通读循环代码来理解到底要过滤什么，要过滤的东西就在传递给他的那个函数里面。</p>
<h2 id="finding"><a href="#finding" class="headerlink" title="finding"></a>finding</h2><p><em>filter</em> 已经信手拈来了吧。这时如果只想找一个英雄该怎么办？比如找 “Black Widow”。使用 <em>filter</em> 会写出如下代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isBlackWidow</span>(<span class="params">hero</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> (hero.name === <span class="string">'Black Widow'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> blackWidow = heroes.filter(isBlackWidow)[<span class="number">0</span>];</div></pre></td></tr></table></figure></p>
<p>这段代码的问题是效率不够高。<em>filter</em> 会检查数组中的每一个元素，而我们知道这里面只有一个 “Black Widow”，当找到她的时候就可以停住，不用再看后面的元素了。那么，依旧利用谓词函数，我们写一个 <em>find</em> 函数来返回第一次匹配上的元素。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">find</span>(<span class="params">predicate, arr</span>) </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> arr) &#123;</div><div class="line">        <span class="keyword">if</span> (predicate(item)) &#123;</div><div class="line">            <span class="keyword">return</span> item;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> blackWidow = find(isBlackWidow, heroes);</div></pre></td></tr></table></figure></p>
<p>同样地，JavaScript 已经提供了这样的方法：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> blackWidow = heroes.find(isBlackWidow);</div></pre></td></tr></table></figure></p>
<p>至此为止，<em>find</em> 再次体现了出小力办大事的原则。通过 <em>find</em> 方法，把问题简化为：你只要关注如何判断你要找的东西就可以了。不必关心迭代器到底怎么实现等细节问题。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这些迭代器函数的例子很好地诠释了为什么“抽象”非常有用。回想一下我们所讲的内置方法，每个例子中我们都做了三件事：</p>
<ol>
<li>避免循环结构，使得代码变的简洁易读；</li>
<li>通过适当的方法名称来描述我们使用的模式，也就是：<em>map</em>，<em>reduce</em>，<em>filter</em> 和 <em>find</em>；</li>
<li>把问题从处理整个数组简化到处理每个元素。</li>
</ol>
<p>这里要注意的是，我们把每个问题都打散，用一个或几个纯函数来解决。而真正令人兴奋的是仅仅通过 4 个模式（当然还有其他的模式，也建议大家去学习一下），在 JS 代码中你就可以消除几乎所有的循环了。这是因为 JS 中几乎每个循环都是用来处理数组，或者生成数组的。通过消除循环，降低了复杂性，也使得代码的可维护性更强。</p>

        </div>
        <footer class="article-footer">
            

    <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more">分享到：</a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间">QQ空间</a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博">新浪微博</a>
    <a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博">腾讯微博</a>
    <a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网">人人网</a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信">微信</a>
</div>
<script>
window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{"bdSize":16}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
<style>
    .bdshare_popup_box {
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .bdshare-button-style0-16 a,
    .bdshare-button-style0-16 .bds_more {
        padding-left: 20px;
        margin: 6px 10px 6px 0;
    }
    .bdshare_dialog_list a,
    .bdshare_popup_list a,
    .bdshare_popup_bottom a {
        font-family: 'Microsoft Yahei';
    }
    .bdshare_popup_top {
        display: none;
    }
    .bdshare_popup_bottom {
        height: auto;
        padding: 5px;
    }
</style>



        </footer>
    </div>
</article>

    <section id="comments">
    
        
    <div class="ds-thread" data-thread-key="/blog/js-without-loops/" data-title="无循环 JavaScript" data-url="http://xiaoxiaoqdq.com//blog/js-without-loops/"></div>
    <style>
        #ds-thread #ds-reset .ds-textarea-wrapper {
            background: none;
        }
        #ds-reset .ds-avatar img {
            box-shadow: none;
        }
        #ds-reset .ds-gradient-bg {
            background: #f7f7f7;
        }
        #ds-thread #ds-reset li.ds-tab a {
            border-radius: 3px;
        }
        #ds-thread #ds-reset .ds-post-button {
            color: white;
            border: none;
            box-shadow: none;
            background: #d32;
            text-shadow: none;
            font-weight: normal;
            font-family: 'Microsoft Yahei';
        }
        #ds-thread #ds-reset .ds-post-button:hover {
            color: white;
            background: #DE594C;
        }
        #ds-thread #ds-reset .ds-post-button:active {
            background: #d32;
        }
        #ds-smilies-tooltip ul.ds-smilies-tabs li a.ds-current {
            color: white;
            background: #d32;
            box-shadow: none;
            text-shadow: none;
            font-weight: normal;
        }
    </style>

    
    </section>


                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>关注我 :</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/XiaoxiaoGroup" target="_blank">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="weibo" href="http://weibo.com/u/6171082045" target="_blank">
                        <i class="icon fa fa-weibo"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/blog/cs-flexbox-works-1/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">下一篇</strong>
        <p class="article-nav-title">
        
            通过动图形象地为你介绍Flexbox是如何工作的（一）
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/blog/ms-beginner/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">上一篇</strong>
        <p class="article-nav-title">Web前端开发工程师编程能力飞升之路</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/blog/se-http-cdn/" class="thumbnail">
    
    
        <span style="background-image:url(https://huzidaha.github.io/images-store/201702/9-1.png)" alt="掌握 HTTP 缓存——从请求到响应过程的一切" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/前端笔记/">前端笔记</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/categories/前端笔记/Service/">Service</a></p>
                            <p class="item-title"><a href="/blog/se-http-cdn/" class="title">掌握 HTTP 缓存——从请求到响应过程的一切</a></p>
                            <p class="item-date"><time datetime="2017-03-11T15:32:00.000Z" itemprop="datePublished">2017-03-11</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/blog/cs-flexbox-works-2/" class="thumbnail">
    
    
        <span style="background-image:url(https://huzidaha.github.io/images-store/201702/5-1PghNPeo_XAXroKXksXGfCQ.png)" alt="通过动图形象地为你介绍 Flexbox 是如何工作的（二）" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/前端笔记/">前端笔记</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/categories/前端笔记/CSS/">CSS</a></p>
                            <p class="item-title"><a href="/blog/cs-flexbox-works-2/" class="title">通过动图形象地为你介绍 Flexbox 是如何工作的（二）</a></p>
                            <p class="item-date"><time datetime="2017-03-11T15:18:00.000Z" itemprop="datePublished">2017-03-11</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/blog/cs-flexbox-works-1/" class="thumbnail">
    
    
        <span style="background-image:url(https://huzidaha.github.io/images-store/201702/3-1.png)" alt="通过动图形象地为你介绍Flexbox是如何工作的（一）" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/前端笔记/">前端笔记</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/categories/前端笔记/CSS/">CSS</a></p>
                            <p class="item-title"><a href="/blog/cs-flexbox-works-1/" class="title">通过动图形象地为你介绍Flexbox是如何工作的（一）</a></p>
                            <p class="item-date"><time datetime="2017-03-11T15:02:00.000Z" itemprop="datePublished">2017-03-11</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/blog/js-without-loops/" class="thumbnail">
    
    
        <span style="background-image:url(https://huzidaha.github.io/images-store/201702/6-1javascript-without-loops.png)" alt="无循环 JavaScript" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/前端笔记/">前端笔记</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/categories/前端笔记/JavaScript/">JavaScript</a></p>
                            <p class="item-title"><a href="/blog/js-without-loops/" class="title">无循环 JavaScript</a></p>
                            <p class="item-date"><time datetime="2017-03-11T14:52:00.000Z" itemprop="datePublished">2017-03-11</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/blog/ms-beginner/" class="thumbnail">
    
    
        <span style="background-image:url(http://ofi3qxlvd.bkt.clouddn.com/image/gallery/%E5%AE%8F%E6%9D%91201606-%E5%AE%89%E5%BE%BD.jpg)" alt="Web前端开发工程师编程能力飞升之路" class="thumbnail-image"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/面试宝典/">面试宝典</a></p>
                            <p class="item-title"><a href="/blog/ms-beginner/" class="title">Web前端开发工程师编程能力飞升之路</a></p>
                            <p class="item-date"><time datetime="2017-03-10T05:32:00.000Z" itemprop="datePublished">2017-03-10</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                <div class="widget-wrap widget-list">
    <h3 class="widget-title">微信公众号</h3>
    <div class="widget">
        <img src="/css/images/wechat.jpg" attr="wechat">
    </div>
</div>

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">分类</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/前端笔记/">前端笔记</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/前端笔记/CSS/">CSS</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端笔记/JavaScript/">JavaScript</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端笔记/Service/">Service</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/面试宝典/">面试宝典</a><span class="category-list-count">1</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">5</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">标签云</h3>
        <div class="widget tagcloud" id="tagcloud">
            <a href="/tags/CDN/" style="font-size: 10px;">CDN</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/css/" style="font-size: 20px;">css</a> <a href="/tags/flexbox/" style="font-size: 20px;">flexbox</a> <a href="/tags/前端工程师/" style="font-size: 10px;">前端工程师</a>
        </div>
    </div>

 
            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://www.w3cfuns.com/" target="_blank">前端网</a>
                    </li>
                
                    <li>
                        <a href="http://www.yyyweb.com" target="_blank">前端里</a>
                    </li>
                
                    <li>
                        <a href="http://www.reqianduan.com" target="_blank">热前端</a>
                    </li>
                
                    <li>
                        <a href="http://www.html-js.com" target="_blank">前端乱炖</a>
                    </li>
                
                    <li>
                        <a href="http://www.webhek.com" target="_blank">WEB骇客</a>
                    </li>
                
                    <li>
                        <a href="https://segmentfault.com/" target="_blank">segmentfault</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>
                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2017 Xiaoxiao</p>
            </div>
        </div>
    </div>
</footer>
        
    
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'xiaoxiaoqdq'};
    (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
    || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    


<!-- Custom Scripts -->
<script src="/js/main.js"></script>
<script src="/js/canvas-nest.js"></script>
<script src="/js/tagcloud.js"></script>


    <!-- Leancloud -->
    <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
    <script>
        AV.initialize('lzP5SSg5UrDRDaM2mX9wUC9c-gzGzoHsz', '7ADl4tgwxomPeaxmUx3HAO1c');
    </script>
    <script>
    function showTime(Counter) {
        var query = new AV.Query(Counter);
        $('.leancloud-views_num').each(function() {
            var url = $(this).attr('id').trim();
            query.equalTo('url', url);
            query.find({
                success: function(results) {
                    if (results.length === 0) {
                        var content = '0 ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                        return;
                    }
                    for (var i = 0; i < results.length; i++) {
                        var object = results[i];
                        var content = object.get('time') + ' ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                    }
                },
                error: function(object, error) {
                    console.log('Error: ' + error.code + ' ' + error.message);
                }
            });
        });
    }

    function addCount(Counter) {
      var Counter = AV.Object.extend('Counter');
      url = $('.leancloud-views_num').attr('id').trim();
      title = $('.leancloud-views_num').attr('data-flag-title').trim();
      var query = new AV.Query(Counter);
      query.equalTo('url', url);
      query.find({
          success: function(results) {
            if (results.length > 0) {
                var counter = results[0];
                counter.fetchWhenSave(true);
                counter.increment('time');
                counter.save(null, {
                    success: function(counter) {
                        var content =  counter.get('time') + ' ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                    },
                    error: function(counter, error) {
                        console.log('Failed to save Visitor num, with error message: ' + error.message);
                    }
                });
            } else {
              var newcounter = new Counter();
              newcounter.set('title', title);
              newcounter.set('url', url);
              newcounter.set('time', 1);
              newcounter.save(null, {
                  success: function(newcounter) {
                      console.log('newcounter.get(\'time\')='+newcounter.get('time'));
                      var content = newcounter.get('time') + ' ' + $(document.getElementById(url)).text();
                      $(document.getElementById(url)).text(content);
                  },
                  error: function(newcounter, error) {
                      console.log('Failed to create');
                  }
              });
            }
        },
        error: function(error) {
            console.log('Error:' + error.code + ' ' + error.message);
        }
      });
    }
    $(function() {
        var Counter = AV.Object.extend('Counter');
        if ($('.leancloud-views_num').length === 1) {
            addCount(Counter);
        } else if ($('.post-title-link').length > 1) {
            showTime(Counter);
        }
    });
</script>



    </div>
</body>
</html>
